<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/reset.css' %}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/book-info-style.css' %}?v=1" />
    <link rel="stylesheet" href="{% static 'css/user-book-info-style.css' %}?v=1" />
    <link rel="stylesheet" href="{% static 'css/modal-style.css' %}" />
    <link rel="icon" href="{% static 'images/favicon.png' %}" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <title>{{ book.title }} - Info</title>
</head>

<body>
    <div class="container">
        <div class="left-side">
            <a href="{% url 'toggle_favourite' book_list.pk %}" class="favourite-link">
                <button class="heart-button {% if book_list.favourites %}active{% endif %}" id="heartButton"
                    title="{% if book_list.favourites %}Remove from favourites{% else %}Add to favourites{% endif %}">
                    <svg class="heart-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path class="heart-path" d="M12 21.35
             L10.55 20.03
             C5.4 15.36 2 12.28 2 8.5
             C2 5.42 4.42 3 7.5 3
             C9.24 3 10.91 3.81 12 5.09
             C13.09 3.81 14.76 3 16.5 3
             C19.58 3 22 5.42 22 8.5
             C22 12.28 18.6 15.36 13.45 20.03
             L12 21.35
             Z" />
                    </svg>
                </button>
            </a>
            {% if book.thumbnail %}
            <div class="background-blur" style="background-image: url('{{ book.thumbnail }}');"></div>
            {% else %}
            <div class="background-blur" style="background-image: url('{% static 'images/image-not-found.png' %}');">
            </div>
            {% endif %}
            <div class="book-cover-container">
                {% if book.thumbnail %}
                <img src="{{ book.thumbnail }}" alt="book cover" class="book-cover-img">
                {% else %}
                <img src="{% static 'images/image-not-found.png' %}" alt="book cover" class="book-cover-img">
                {% endif %}
            </div>
        </div>
        <div class="right-side">
            <div class="book-info-container">


                <header class="user-book-info-header">
                    <h1>{{ book.title }}</h1>
                    <button class="close-button" aria-label="Close" onclick="history.back()"></button>
                    <div class="vertical-line"></div>
                    <div class="pages-status-info">
                        <p>Status: {{ book_list.get_status_display }}</p>
                        <p>Pages read: {{ book_list.pages_read }}</p>
                    </div>
                </header>
                {% if book.subtitle %}<h3>{{ book.subtitle }}</h3>{% endif %}
                <div class="action-buttons">
                    <button class="icon-button status-button" data-bs-toggle="modal"
                        data-bs-target="#editModal{{ book_list.pk }}" title="Change Book Status">
                        <i class="fas fa-tasks"></i>
                    </button>
                    <button class="icon-button pages-button" data-bs-toggle="modal"
                        data-bs-target="#editPagesModal{{ book_list.pk }}" title="Change Pages Read">
                        <i class="fas fa-bookmark"></i>
                    </button>
                    <button class="icon-button remove-button" data-bs-toggle="modal"
                        data-bs-target="#deleteModal{{ book_list.pk }}" title="Remove from List">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>

                <div class="book-details-wrapper">
                    <div class="book-details">
                        <div class="detail-pair">
                            <p class="detail-label">Authors:</p>
                            <div class="detail-value">
                                <p>{{ book.authors }}</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">Published:</p>
                            <div class="detail-value scrollable-value">
                                <p>{{ book.published_year }}</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">Number of pages:</p>
                            <div class="detail-value scrollable-value">
                                <p>{{ book.num_pages }}</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">Rating:</p>
                            <div class="detail-value scrollable-value">
                                <p>{{ book.average_rating|floatformat:1 }}/5.0</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">ISBN-13:</p>
                            <div class="detail-value scrollable-value">
                                <p>{{ book.isbn13 }}</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">ISBN-10:</p>
                            <div class="detail-value scrollable-value">
                                <p>{{ book.isbn10 }}</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">Categories:</p>
                            <div class="detail-value scrollable-value">
                                <p>{{ book.categories }}</p>
                            </div>
                        </div>
                        <div class="detail-pair">
                            <p class="detail-label">Description:</p>
                            <div class="detail-value book-description">
                                <p>{{ book.description }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal{{ book_list.pk }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" action="{% url 'edit_book' book_list.pk %}">
                {% csrf_token %}
                <input type="hidden" name="action_type" value="change_status">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Status</h5>
                    </div>
                    <div class="modal-body">
                        {{ form.status }}
                        {% if form.status.errors %}
                        <div class="alert alert-danger">
                            {{ form.status.errors }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Save changes</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="editPagesModal{{ book_list.pk }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" action="{% url 'edit_book' book_list.pk %}">
                {% csrf_token %}
                <input type="hidden" name="action_type" value="change_pages">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Pages</h5>
                    </div>
                    <div class="modal-body">
                        {% if book.num_pages %}
                        <p class="text-muted">Book has {{ book.num_pages }} pages total</p>
                        {% endif %}

                        <div class="form-group">
                            <label for="id_pages_read">Pages read:</label>
                            <input type="number" name="pages_read" id="id_pages_read" class="form-control"
                                value="{{ book_list.pages_read }}" min="0" {% if book.num_pages %}max="{{ book.num_pages }}" {% endif %}>
                        </div>

                        {% if form.pages_read.errors %}
                        <div class="alert alert-danger">
                            {{ form.pages_read.errors }}
                        </div>
                        {% endif %}
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Save changes</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="deleteModal{{ book_list.pk }}" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form method="post" action="{% url 'delete_book' book_list.pk %}">
                {% csrf_token %}
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Confirm Deletion</h5>
                    </div>
                    <div class="modal-body">
                        Are you sure you want to remove <strong>"{{ book.title }}"</strong> from your list?
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-danger">Yes, Delete</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script src="{% static 'js/heart-favourite.js' %}"></script>
</body>

</html>